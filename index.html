<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Birthday Surprise üéÇ</title>
<style>
:root {
  --png-scale: 1; /* change this to scale the menu PNG */
}

/* Body */
body {
  background: #222;
  color: white;
  font-family: "Comic Sans MS", cursive, sans-serif;
  text-align: center;
  margin: 0;
  padding-top: 30px;
}

/* Message text */
#message {
  font-size: 5vw; /* scales with screen */
  margin-bottom: 20px;
  line-height: 1.2;
}

/* Cake wrapper scales with screen width */
.cake-wrapper {
  position: relative;
  width: 80vw;       /* responsive width */
  max-width: 400px;  /* optional max size for large screens */
  margin: 30px auto;
  height: auto;
}

/* Cake base */
.cake {
  width: 100%;
  position: relative;
  height: 0;
  padding-bottom: 80%; /* maintain aspect ratio */
}

/* Plate */
.plate {
  width: 108%;
  height: 40%;
  position: absolute;
  bottom: -5%;
  left: -4%;
  background-color: #ccc;
  border-radius: 50%;
  box-shadow: 0 2px 0 #aaa,0 4px 0 #aaa,0 5px 40px rgba(0,0,0,0.5);
}

/* Cake layers */
.layer { position: absolute; width: 100%; height: 33%; border-radius: 50%; background-color: #553c13; }
.layer-top { top: 0; }
.layer-middle { top: 33%; }
.layer-bottom { top: 66%; }

/* Icing */
.icing { position: absolute; top: 2%; left: 2%; width: 96%; height: 90%; border-radius: 50%; background-color: #f0e4d0; }
.icing:before { content:""; position:absolute; top:4px; right:5px; bottom:6px; left:5px; background-color:#f6ebdc; border-radius:50%; box-shadow:0 0 4px #faf3e6,0 0 4px #faf3e6,0 0 4px #faf3e6; }

/* Drips */
.drip { position:absolute; background-color:#f0e4d0; border-bottom-left-radius:50%; border-bottom-right-radius:50%; }
.drip1 { top:53%; left:5%; width: 16%; height: 24%; transform: skewY(15deg); }
.drip2 { top:69%; left:72%; width:16%; height:24%; transform: skewY(-15deg); }
.drip3 { top:54%; left:36%; width:32%; height:28%; }

/* Candle */
.candle { position:absolute; width:6%; height:25%; background:#7B020B; border-radius:50%/25%; top:-12%; left:47%; cursor:pointer; }
.candle:before { content:""; position:absolute; top:0; left:0; width:100%; height:16%; border-radius:50%; background-color:#9a0a13; }

/* Flame */
.flame { position:absolute; top:-70%; left:50%; width:6%; height:35%; margin-left:-3%; background:orange; border-radius: 10% 10% 10% 10% / 25% 25% 10% 10%; box-shadow:0 0 10px rgba(255,165,0,0.5),0 0 20px rgba(255,165,0,0.5),0 0 60px rgba(255,165,0,0.5),0 0 80px rgba(255,165,0,0.5); transform-origin:50% 90%; animation:flicker 1s ease-in-out alternate infinite; }
.flame.off { display:none; }
@keyframes flicker { 0%{transform:skewX(5deg);}25%{transform:skewX(-5deg);}50%{transform:skewX(10deg);}75%{transform:skewX(-10deg);}100%{transform:skewX(5deg);} }

/* Next button + pulsating circle */
#nextBtn {
  display: none;
  margin-top: 30px;
  font-size: 6vw;       /* responsive font */
  padding: 2vw 5vw;     /* responsive padding */
  border-radius: 8px;
  border: none;
  background:red;
  color:white;
  cursor:pointer;
  position: relative;
  z-index:10;
}
#nextBtn::before {
  content:"";
  position:absolute;
  top:-10%;
  left:-10%;
  width:120%;
  height:120%;
  border:3px solid red;
  border-radius:50%;
  animation:pulse 1s infinite alternate;
  z-index:-1;
}
@keyframes pulse { 0%{transform:scale(1);opacity:0.7;} 100%{transform:scale(1.2);opacity:0.3;} }

/* Menu PNG (optional) */
#menuPNG {
  display:none;
  position:absolute;
  width: calc(200px * var(--png-scale));
  height:auto;
  top:10px;
  right:10px;
  z-index:20;
}
</style>
</head>
<body>

<div id="message">Please allow microphone access!</div>

<div class="cake-wrapper">
  <div class="cake">
    <div class="plate"></div>
    <div class="layer layer-bottom"></div>
    <div class="layer layer-middle"></div>
    <div class="layer layer-top"></div>
    <div class="icing"></div>
    <div class="drip drip1"></div>
    <div class="drip drip2"></div>
    <div class="drip drip3"></div>
    <div class="candle">
      <div class="flame"></div>
    </div>
  </div>
</div>

<button id="nextBtn">Next üéÅ</button>
<img id="menuPNG" src="pog.png" alt="Menu highlight">

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
const message = document.getElementById("message");
const flame = document.querySelector(".flame");
const nextBtn = document.getElementById("nextBtn");
const menuPNG = document.getElementById("menuPNG");
let blownOut = false;

// Mic request
navigator.mediaDevices.getUserMedia({ audio: true })
  .then(stream => {
    message.textContent = "Blow the candles as hard as you can!";
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const source = audioCtx.createMediaStreamSource(stream);
    const analyser = audioCtx.createAnalyser();
    source.connect(analyser);
    const dataArray = new Uint8Array(analyser.fftSize);

    function detectBlow() {
      analyser.getByteFrequencyData(dataArray);
      let volume = dataArray.reduce((a,b)=>a+b)/dataArray.length;
      if(volume>20) extinguishFlame();
      if(!blownOut) requestAnimationFrame(detectBlow);
    }
    detectBlow();
  })
  .catch(err=>{
    message.textContent="You forgot to accept the mic request üíî It's alright, you can tap the candle to turn it off.";
  });

flame.addEventListener("click", extinguishFlame);

function extinguishFlame(){
  if(blownOut) return;
  flame.classList.add("off");
  triggerCelebration();
}

function triggerCelebration(){
  blownOut = true;
  message.textContent = "Happy Birthday Miss Supermodel Elif! üéÇ‚ú®";

  confetti(); // celebrate

  const audio = new Audio("bday.mp3"); // replace
  audio.play();

  nextBtn.style.display = "inline-block";
  menuPNG.style.display = "block";
}

nextBtn.addEventListener("click", ()=>{
  window.location.href = "video.html"; // your video page
});
</script>

</body>
</html>
