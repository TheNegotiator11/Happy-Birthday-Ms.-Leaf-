<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Birthday Surprise üéÇ</title>
<style>
  body {
    background: #222;
    color: white;
    font-family: "Comic Sans MS", cursive, sans-serif;
    text-align: center;
    padding-top: 40px;
    margin: 0;
  }

  #message {
    font-size: 22px;
    margin-bottom: 20px;
  }

  .cake-wrapper {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 40px auto;
    height: 300px;
  }

  .cake { position: relative; width: 250px; height: 200px; }
  .plate { width: 270px; height: 110px; position: absolute; bottom: -10px; left: -10px; background-color: #ccc; border-radius: 50%; box-shadow: 0 2px 0 #aaa,0 4px 0 #aaa,0 5px 40px rgba(0,0,0,0.5); }
  .layer { position: absolute; width: 250px; height: 100px; border-radius: 50%; background-color: #553c13; box-shadow: 0 2px 0px #5e4417,0 4px 0px #4d3710,0 6px 0px #4a350f; }
  .layer-top { top: 0px; } .layer-middle { top: 33px; } .layer-bottom { top: 66px; }
  .icing { top: 2px; left: 5px; background-color: #f0e4d0; width: 240px; height: 90px; border-radius: 50%; position: absolute; }
  .icing:before { content:""; position:absolute; top:4px; right:5px; bottom:6px; left:5px; background-color:#f6ebdc; box-shadow:0 0 4px #faf3e6,0 0 4px #faf3e6,0 0 4px #faf3e6; border-radius:50%; }
  .drip { display:block; width:50px; height:60px; border-bottom-left-radius:25px; border-bottom-right-radius:25px; background-color:#f0e4d0; position:absolute; }
  .drip1 { top:53px; left:5px; transform:skewY(15deg); height:48px; width:40px; }
  .drip2 { top:69px; left:181px; transform:skewY(-15deg); }
  .drip3 { top:54px; left:90px; width:80px; border-bottom-left-radius:40px; border-bottom-right-radius:40px; }
  .candle { background-color:#7B020B; width:16px; height:50px; border-radius:8px/4px; top:-20px; left:50%; margin-left:-8px; z-index:10; position:absolute; cursor:pointer; }
  .candle:before { content:""; position:absolute; top:0; left:0; width:16px; height:8px; border-radius:50%; background-color:#9a0a13; }
  .flame { position:absolute; background-color:orange; width:15px; height:35px; border-radius:10px 10px 10px 10px / 25px 25px 10px 10px; top:-34px; left:50%; margin-left:-7.5px; z-index:10; box-shadow:0 0 10px rgba(255,165,0,0.5),0 0 20px rgba(255,165,0,0.5),0 0 60px rgba(255,165,0,0.5),0 0 80px rgba(255,165,0,0.5); transform-origin:50% 90%; animation:flicker 1s ease-in-out alternate infinite; }
  .flame.off { display:none; }
  @keyframes flicker { 0%{transform:skewX(5deg);}25%{transform:skewX(-5deg);}50%{transform:skewX(10deg);}75%{transform:skewX(-10deg);}100%{transform:skewX(5deg);} }

  #nextBtn {
    display:none;
    margin-top:30px;
    padding:12px 24px;
    font-size:20px;
    border:none;
    border-radius:8px;
    background:red;
    color:white;
    cursor:pointer;
    position:relative;
    z-index:10;
  }

  #memeHighlight {
    display:none;
    position:absolute;
    width:30vw;
    max-width:150px;
    height:auto;
    z-index:5;
    pointer-events:none;
    animation:pulse 1s infinite alternate;
  }

  @keyframes pulse { 0% { transform: scale(1);} 100% { transform: scale(1.1); } }

  /* Mobile adjustments */
  @media (max-width: 600px) {
    #memeHighlight { width:40vw; }
    #nextBtn { font-size:18px; padding:10px 20px; }
    #message { font-size:18px; }
  }
</style>
</head>
<body>
  <div id="message">Please allow microphone access!</div>

  <div class="cake-wrapper">
    <div class="cake">
      <div class="plate"></div>
      <div class="layer layer-bottom"></div>
      <div class="layer layer-middle"></div>
      <div class="layer layer-top"></div>
      <div class="icing"></div>
      <div class="drip drip1"></div>
      <div class="drip drip2"></div>
      <div class="drip drip3"></div>
      <div class="candle">
        <div class="flame"></div>
      </div>
    </div>
  </div>

  <button id="nextBtn">Next üéÅ</button>
  <img id="memeHighlight" src="pog.png" alt="meme highlight" />

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script>
    const message = document.getElementById("message");
    const flame = document.querySelector(".flame");
    const nextBtn = document.getElementById("nextBtn");
    const memeHighlight = document.getElementById("memeHighlight");
    let blownOut = false;

    // Ask for mic
    navigator.mediaDevices.getUserMedia({ audio: true })
      .then(stream => {
        message.textContent = "Blow the candles!";
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const source = audioCtx.createMediaStreamSource(stream);
        const analyser = audioCtx.createAnalyser();
        source.connect(analyser);
        const dataArray = new Uint8Array(analyser.fftSize);

        function detectBlow() {
          analyser.getByteFrequencyData(dataArray);
          let volume = dataArray.reduce((a,b)=>a+b)/dataArray.length;
          if(volume>20) extinguishFlame();
          if(!blownOut) requestAnimationFrame(detectBlow);
        }
        detectBlow();
      })
      .catch(err=>{
        message.textContent="Why did you deny the mic request üò≠ It's alright, you can tap the candle to turn it off.";
      });

    flame.addEventListener("click", extinguishFlame);

    function extinguishFlame(){
      if(blownOut) return;
      flame.classList.add("off");
      triggerCelebration();
    }

    function triggerCelebration(){
      blownOut = true;
      message.textContent = "Happy Birthday Miss Supermodel Elif! üéÇ‚ú®";

      confetti();
      const audio = new Audio("bday.mp3");
      audio.play();

      nextBtn.style.display = "inline-block";
      showMemeHighlight();
    }

    function showMemeHighlight(){
      const cake = document.querySelector(".cake");
      const rect = cake.getBoundingClientRect();
      // PNG near cake, arrow points to Next button
      memeHighlight.style.left = `${rect.left - rect.width*0.25}px`;
      memeHighlight.style.top  = `${rect.top + rect.height*0.05}px`;
      memeHighlight.style.display = "block";
    }

    nextBtn.addEventListener("click", ()=>{
      window.location.href = "video.html";
    });
  </script>
</body>
</html>
